<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Продукт — VIVASAM</title>
  <link href="assets/img/logo_white.webp" rel="icon">

  <!-- Bootstrap and icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.1/font/bootstrap-icons.min.css"
    rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
  <link href="assets/css/style.css" rel="stylesheet" />

  <style>

  </style>
</head>

<body>

  <div id="loading-overlay"
    style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:#fff;z-index:9999;align-items:center;justify-content:center">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <!-- Navbar (copied from index_new.html) -->
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm" id="mainNav">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center" href="index.html">
        <img src="assets/img/logo.webp" alt="VIVASAM" class="logo-img me-2">
        <span class="brand-text">VIVASAM</span>
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto align-items-center gap-3">
          <li class="nav-item">
            <a class="nav-link" href="index.html#home" data-i18n="home">Главная</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="index.html#about" data-i18n="about">О компании</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="index.html#products" data-i18n="products">Наши продукты</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="index.html#partners" data-i18n="partners">Партнёры</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="index.html#contact" data-i18n="contact">Контакты</a>
          </li>
          <li class="nav-item">
            <select id="language-select" class="form-select form-select-sm ms-3 fs-6 fw-medium">
              <option value="en">English</option>
              <option value="ru" selected>Русский</option>
              <option value="uz">O'zbek</option>
            </select>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <main class="container product-section">
    <div class="row align-items-center">
      <!-- Product Image Swiper -->
      <div class="col-lg-5 mb-4">
        <div class="swiper mySwiper">
          <div class="swiper-wrapper">
            <div class="swiper-slide"><img id="product-image0" class="img-fluid product-image" /></div>
            <div class="swiper-slide"><img id="product-image1" class="img-fluid product-image" /></div>
            <div class="swiper-slide"><img id="product-image2" class="img-fluid product-image" /></div>
          </div>
          <div class="swiper-pagination"></div>
        </div>
      </div>
      <div class="col-lg-7">
        <h2 id="product-name" class="fw-bold mb-3 product-title"></h2>
        <p id="product-main-description" class="mb-4 text-muted"></p>
        <div class="accordion" id="descriptionAccordion">
          <!-- Accordion items will be rendered by JS -->
        </div>
      </div>
    </div>

    <section class="related-products my-5">
      <h3 class="text-center mb-5" id="related-title" data-i18n="related">Похожие продукты</h3>
      <div class="row g-4 justify-content-center align-items-stretch" id="related-products"></div>
    </section>
  </main>

  <!-- Footer (copied from index_new.html) -->
  <footer class="footer bg-dark text-light py-5">
    <div class="container">
      <div class="row">
        <div class="col-lg-2 mb-4 flex footer-brand">
          <img src="assets/img/logo_white.webp" alt="VIVASAM" class="footer-logo mb-3">
          <p class="brand-tagline" data-i18n="brandTagline">Foundation of Health</p>
        </div>
        <div class="col-lg-2">
        </div>
        <div class="col-lg-4 mb-4">
          <h5 class="footer-title" data-i18n="contactInfo">Контактная информация</h5>
          <div class="footer-contact">
            <div class="contact-item">
              <a class="text-decoration-none text-white" href="https://maps.app.goo.gl/gRtKQp9gjCMxRC2k8" target="_blank">
              <i class="bi bi-geo-alt me-2"></i>
              <span  data-i18n="location">г.Ташкент, Яккасаройский район, улица Бабура 73 А</span>
            </a>
            </div>
            <div class="contact-item">
              <i class="bi bi-telephone me-2"></i>
                  <a class="text-decoration-none text-white" href="tel:+998972544442"><p>+998972544442</p></a>
            </div>
            <div class="contact-item">
              <i class="bi bi-envelope me-2"></i>
              <a class="text-decoration-none text-white" href="mailto:Vivasam-group@mail.ru"><span>Vivasam-group@mail.ru</span></a>
            </div>
          </div>
        </div>
        <div class="col-lg-4 mb-4">
          <h5 class="footer-title" data-i18n="followUs">Социальные сети</h5>
          <div class="social-links">
            <a href="https://www.instagram.com/vivasam.group" target="_blank" class="social-link"><i
                class="bi bi-instagram"></i></a>
            <a href="https://www.facebook.com/profile.php?id=100088411987053" target="_blank" class="social-link"><i
                class="bi bi-facebook"></i></a>
            <a href="https://t.me/vivasamgroup" target="_blank" class="social-link"><i class="bi bi-telegram"></i></a>
            <a href="https://youtube.com/@vivasamgroup?si=4iqNknhEHCJZ28js" target="_blank" class="social-link"><i
                class="bi bi-youtube"></i></a>
          </div>
        </div>
      </div>
      <hr class="footer-divider">
      <div class="row align-items-center">
        <div class="col-md-12 text-center">
          <p class="copyright mb-0" data-i18n="copyright">
            © 2022 VIVASAM Group. Все права защищены.
          </p>
        </div>
      </div>
    </div>
  </footer>

  <button id="back-to-top" class="back-to-top">
    <i class="bi bi-arrow-up"></i>
  </button>

  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="assets/js/app.js"></script>

  <script>
    // Language logic (same as index_new.html)
    const storedLang = localStorage.getItem("selectedLanguage");
    const browserLang = (navigator.language || 'ru').slice(0, 2);
    const currentLang = ['uz', 'ru', 'en'].includes(storedLang) ? storedLang : (['uz', 'ru', 'en'].includes(browserLang) ? browserLang : 'ru');
    document.addEventListener("DOMContentLoaded", () => {
      const langSelect = document.getElementById("language-select");
      if (langSelect) langSelect.value = currentLang;
      langSelect.addEventListener("change", (e) => {
        const newLang = e.target.value;
        localStorage.setItem("selectedLanguage", newLang);
        location.reload();
      });
    });

    // Product details rendering
    const params = new URLSearchParams(window.location.search);
    const index = parseInt(params.get("index")) || 0;
    fetch('./data/products.json')
      .then(res => res.json())
      .then(products => {
        const product = products[index];
        product.images.forEach((src, i) => {
          const imgEl = document.getElementById(`product-image${i}`);
          if (imgEl) imgEl.src = src;
        });
        document.getElementById("product-name").innerText = product.name[currentLang] || product.name.ru;
        document.getElementById("product-main-description").innerText = product.specialty?.[currentLang] || product.specialty?.ru || "";

        // Accordion rendering
        const accordion = document.getElementById("descriptionAccordion");
        accordion.innerHTML = "";

        const titles = product?.description_titles || {};
        const titleKeys = ["first", "second", "third", "fourth", "fifth", "sixth"];

        for (let i = 1; i <= 6; i++) {
          const descKey = `description${i}`;
          const descText = product?.[descKey]?.[currentLang] || product?.[descKey]?.ru || "";
          if (!descText) continue;

          const title = titles[titleKeys[i - 1]]?.[currentLang] || titles[titleKeys[i - 1]]?.ru || `Детали ${i}`;

          accordion.innerHTML += `
    <div class="accordion-item">
      <h2 class="accordion-header" id="heading${i}">
        <button class="accordion-button ${i > 1 ? "collapsed" : ""}" type="button"
          data-bs-toggle="collapse"
          data-bs-target="#desc${i}"
          aria-expanded="${i === 1}"
          aria-controls="desc${i}">
          ${title}
        </button>
      </h2>
      <div id="desc${i}" class="accordion-collapse collapse ${i === 1 ? "show" : ""}" 
           aria-labelledby="heading${i}" 
           data-bs-parent="#descriptionAccordion">
        <div class="accordion-body">${descText}</div>
      </div>
    </div>
  `;
        }


        // Related products creative cards with swiper
        const relatedContainer = document.getElementById("related-products");
        relatedContainer.innerHTML = "";
        products.forEach((p, i) => {
          if (i !== index) {
            const swiperClass = `related-swiper`;
            relatedContainer.innerHTML += `
         <a href="product.html?index=${i}" class="col-md-4 col-sm-6 text-decoration-none text-dark">
  <div class="product-card h-100 d-flex flex-column justify-content-between">
    <div class="swiper product-swiper swiper-${i}">
      <div class="swiper-wrapper">
        ${p.images.map((img) => `
          <div class="swiper-slide">
            <img src="${img}" class="card-img-top" alt="${p.name?.[currentLang] || p.name?.ru}">
          </div>
        `).join("")}
      </div>
      <div class="swiper-pagination swiper-pagination-${i}"></div>
    </div>

    <div class="product-card-body flex-grow-1">
      <div class="product-card-title">${p.name?.[currentLang] || p.name?.ru}</div>
      <div class="btn mt-2">
        ${currentLang == "uz" ? "Batafsil" : currentLang == "en" ? "Learn More" : "Подробнее"}
      </div>
    </div>
  </div>
</a>

          `;
            setTimeout(() => {
              new Swiper(`.${swiperClass}`, {
                loop: true,
                pagination: {
                  el: `.${swiperClass} .swiper-pagination`,
                  clickable: true,
                },
              });
            }, 0);
          }
        });

        document.addEventListener("DOMContentLoaded", function () {
          const swipers = document.querySelectorAll(".product-swiper");

          swipers.forEach((swiperEl, index) => {
            new Swiper(swiperEl, {
              loop: true,
              pagination: {
                el: `.swiper-pagination-${index}`,
                clickable: true,
              },
            });
          });
        });


        document.querySelectorAll('.swiper').forEach((el) => {
          new Swiper(el, {
            loop: true,
            pagination: {
              el: el.querySelector('.swiper-pagination'),
              clickable: true
            }
          });
        });


        // Swiper for main product images
        document.addEventListener("DOMContentLoaded", function () {
          const swiper = new Swiper("#main-product-swiper", {
            loop: true,
            pagination: {
              el: "#main-swiper-pagination",
              clickable: true,
            },
          });
        });


        // Translate "related products" title
        const relatedTitle = document.getElementById("related-title");
        if (relatedTitle) {
          const relatedTranslations = {
            uz: "O‘xshash mahsulotlar",
            ru: "Похожие продукты",
            en: "Related products"
          };
          relatedTitle.textContent = relatedTranslations[currentLang] || relatedTranslations["ru"];
        }
      });
  </script>
  <script>
  // Language logic (same as index_new.html)
  const storedLanguage = localStorage.getItem("selectedLanguage");
  const browserLanguage = (navigator.language || 'ru').slice(0, 2);
  const currentLanguage = ['uz', 'ru', 'en'].includes(storedLanguage) ? storedLanguage : (['uz', 'ru', 'en'].includes(browserLanguage) ? browserLang : 'ru');
  document.addEventListener("DOMContentLoaded", () => {
    const langSelect = document.getElementById("language-select");
    if (langSelect) langSelect.value = currentLanguage;
    langSelect.addEventListener("change", (e) => {
      const newLang = e.target.value;
      localStorage.setItem("selectedLanguage", newLang);
      location.reload();
    });

    // --- ADD THIS BLOCK TO FORCE TRANSLATION ON LOAD ---
    // If select value and localStorage are not equal, fix and reload
    if (langSelect && langSelect.value !== currentLanguage) {
      langSelect.value = currentLanguage;
      localStorage.setItem("selectedLanguage", currentLanguage);
      location.reload();
    }
    // --------------------------------------------------
  });
// ...existing code...
</script>
</body>

</html>